---
import '../styles/global.css';

interface Props {
  title: string;
  description?: string;
  ogTitle?: string;
  ogDescription?: string;
  ogType?: string;
  ogImage?: string;
  canonicalUrl?: string;
}

const {
  title,
  description = 'A minimal retrospective board',
  ogTitle,
  ogDescription,
  ogType = 'website',
  ogImage,
  canonicalUrl,
} = Astro.props;

const siteName = 'retrospective';
const finalOgTitle = ogTitle || title;
const finalOgDescription = ogDescription || description;
---

<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content={description} />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    {canonicalUrl && <link rel="canonical" href={canonicalUrl} />}

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content={ogType} />
    <meta property="og:site_name" content={siteName} />
    <meta property="og:title" content={finalOgTitle} />
    <meta property="og:description" content={finalOgDescription} />
    {canonicalUrl && <meta property="og:url" content={canonicalUrl} />}
    {ogImage && <meta property="og:image" content={ogImage} />}

    <!-- Twitter -->
    <meta name="twitter:card" content={ogImage ? 'summary_large_image' : 'summary'} />
    <meta name="twitter:title" content={finalOgTitle} />
    <meta name="twitter:description" content={finalOgDescription} />
    {ogImage && <meta name="twitter:image" content={ogImage} />}

    <!-- Preload font -->
    <link rel="preload" href="/annotation-mono-regular.woff2" as="font" type="font/woff2" crossorigin />

    <title>{title}</title>
  </head>
  <body class="font-mono text-sketch-dark min-h-screen bg-bg">
    <!-- Hand-drawn SVG filter -->
    <svg height="0" width="0" class="absolute">
      <!-- Default filter (stronger for Chrome/Safari/WebKit) -->
      <filter id="handDrawnNoise" x="-20%" y="-20%" width="140%" height="140%" color-interpolation-filters="sRGB">
        <feTurbulence
          type="fractalNoise"
          baseFrequency="0.04"
          numOctaves="2"
          seed="0"
          result="noise"
        />
        <feDisplacementMap
          in="SourceGraphic"
          in2="noise"
          scale="2"
          xChannelSelector="R"
          yChannelSelector="G"
        />
      </filter>
      <!-- Lighter filter for Firefox (renders displacement more strongly) -->
      <filter id="handDrawnNoiseFirefox" x="-20%" y="-20%" width="140%" height="140%" color-interpolation-filters="sRGB">
        <feTurbulence
          type="fractalNoise"
          baseFrequency="0.04"
          numOctaves="1"
          seed="0"
          result="noise"
        />
        <feDisplacementMap
          in="SourceGraphic"
          in2="noise"
          scale="1"
          xChannelSelector="R"
          yChannelSelector="G"
        />
      </filter>
    </svg>
    <script is:inline>
      // Firefox renders displacement maps more strongly, use lighter filter
      if (/Firefox/.test(navigator.userAgent)) {
        document.documentElement.style.setProperty('--doodly-filter', 'url(#handDrawnNoiseFirefox)');
      }
    </script>
    <main>
      <slot />
    </main>
  </body>
</html>

